# 索引管理

管理文件搜索索引，保持搜索功能正常工作。

## 1. 能做什么
- **查看索引状态**：看到每个挂载点的索引健康度、待处理变更数量。
- **重建索引**：完整扫描所有文件，重新建立搜索索引（适合首次使用或索引损坏）。
- **应用变更**：只更新有变化的文件，快速同步索引（适合日常维护）。
- **监控任务**：实时查看索引任务进度，可随时停止长时间运行的任务。
- **清理索引**：删除损坏或不需要的索引数据。

## 2. 什么是索引

> 索引就像图书馆的目录卡片，帮助你快速找到想要的文件。

当你在 CloudPaste 中搜索文件时，系统不是逐个打开文件查找，而是查询预先建立的"索引"。索引记录了每个文件的名称、路径、内容摘要等信息，让搜索变得飞快。

**为什么需要管理索引？**
- 新上传的文件需要加入索引才能被搜索到
- 删除或修改文件后，索引需要更新
- 索引可能因为各种原因损坏，需要重建

## 3. 索引状态说明

进入"管理后台 → 索引管理"，你会看到每个挂载点的状态：

- **✅ 就绪 (ready)**：索引正常，可以搜索
- **🔄 索引中 (indexing)**：正在建立或更新索引
- **⚠️ 未就绪 (not_ready)**：索引还没建立，或建立失败
- **❌ 错误 (error)**：上次操作失败，需要处理

**健康度指标**：显示处于"就绪"状态的挂载点百分比，100% 表示所有挂载点索引都正常。

## 4. 两种索引操作

### 重建索引（完整扫描）

**什么时候用：**
- 首次使用某个挂载点
- 索引状态显示"未就绪"或"错误"
- 怀疑索引数据不准确
- 待处理变更数量很大（系统会推荐）

**工作原理：**
从挂载点根目录开始，逐个扫描所有文件和文件夹，建立完整索引。

**操作步骤：**
1. 在挂载点列表中找到目标挂载点
2. 点击"重建"按钮（或使用右侧操作面板）
3. 可选配置：
   - **批次大小**：每次处理多少个文件（20-1000，默认 100）
   - **最大深度**：扫描到第几层文件夹（0 表示不限制）
4. 确认后开始，可在"运行中任务"区域查看进度

### 应用变更（增量更新）

**什么时候用：**
- 日常维护，有少量文件变化
- 看到"待处理变更"数量不为 0
- 系统推荐"应用变更"

**工作原理：**
只处理有变化的文件（新增、修改、删除），不重新扫描全部文件。

**操作步骤：**
1. 在挂载点列表中找到有"待处理变更"的挂载点
2. 点击"应用变更"按钮
3. 可选配置：
   - **批次大小**：每次处理多少条变更（10-2000，默认 100）
   - **最大处理数**：最多处理多少条（0 表示全部处理）
   - **重建子树**：如果变更涉及文件夹，是否重新扫描整个文件夹
4. 确认后开始

## 5. 使用建议

### 推荐的维护策略

1. **首次使用**：为每个挂载点执行一次"重建索引"
2. **日常维护**：定期查看"待处理变更"，超过 100 条时执行"应用变更"
3. **出现问题**：如果搜索结果不准确，尝试"重建索引"

### 性能优化

- **批次大小**：
  - 小批次（20-50）：占用资源少，适合服务器性能一般的情况
  - 大批次（500-1000）：速度快，适合性能好的服务器

- **最大深度**：
  - 如果只需要索引浅层文件，可以限制深度（如 3-5 层）
  - 深层嵌套的文件夹会增加索引时间

### 何时停止任务

如果索引任务运行时间过长，或者发现配置错误，可以随时点击"停止"按钮。已处理的部分会保留，下次可以继续。

## 6. 常见场景

### 场景 1：新挂载点无法搜索

**问题**：刚添加的挂载点，搜索不到任何文件。

**解决**：
1. 进入"索引管理"
2. 找到该挂载点，状态应该是"未就绪"
3. 点击"重建"按钮，等待完成
4. 状态变为"就绪"后即可搜索

### 场景 2：上传文件后搜索不到

**问题**：刚上传的文件，搜索结果中没有。

**解决**：
1. 查看该挂载点的"待处理变更"数量
2. 点击"应用变更"按钮
3. 等待完成后重新搜索

### 场景 3：搜索结果不准确

**问题**：搜索到已删除的文件，或找不到明明存在的文件。

**解决**：
1. 执行"重建索引"（完整扫描）
2. 如果问题依然存在，可以先"清理索引"，再"重建索引"

### 场景 4：索引任务卡住

**问题**：索引任务显示"索引中"，但进度长时间不动。

**解决**：
1. 点击"停止"按钮
2. 检查挂载点配置是否正确（存储凭证、网络连接）
3. 重新执行索引操作

## 7. 故障排查

### 索引状态一直是"未就绪"

- 检查挂载点配置是否正确
- 查看是否有权限访问存储
- 尝试手动"重建索引"，查看错误信息

### 待处理变更数量一直增加

- 可能有程序在持续修改文件
- 建议在文件变化较少的时候执行"应用变更"
- 如果数量超过 5000，系统会推荐"重建索引"

### 索引任务失败

- 查看错误信息（点击挂载点卡片查看详情）
- 常见原因：
  - 存储凭证过期
  - 网络连接问题
  - 文件权限不足
  - 存储空间不足

### 搜索速度慢

- 检查索引状态是否为"就绪"
- 如果索引数据量很大，考虑优化搜索关键词
- 可以尝试"清理索引"后"重建索引"

---
